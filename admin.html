{% extends "base.html" %} {% block content %}

<div class="dashboard-container">
  <h2>Pengelolaan Pendaftaran</h2>

  <!-- Statistik -->
  <div class="stats">
    <div class="card">
      <p>Total Pendaftar :</p>
      <h3>{{ total_pendaftar }}</h3>
    </div>
    <div class="card">
      <p>Didisposisi :</p>
      <h3>{{ disposisi }}</h3>
    </div>
    <div class="card">
      <p>Diterima :</p>
      <h3>{{ diterima }}</h3>
    </div>
  </div>

  <!-- Tabel Pendaftar -->
  <div class="table-container">
    <div class="table-header">
      <h3>Daftar Pendaftar :</h3>
      <form method="GET" action="{{ url_for('admin') }}">
        <input
          type="text"
          name="search"
          placeholder="Search . . ."
          value="{{ search or '' }}"
        />
        <button type="submit">üîç</button>
      </form>
    </div>

    <!-- Tambahkan pembungkus scroll -->
    <div class="table-wrapper">
      <table class="data-table">
        <thead>
          <tr>
            <th>Nama</th>
            <th>Email</th>
            <th>No. Telp</th>
            <th>Universitas</th>
            <th>Tgl Mulai</th>
            <th>Tgl Selesai</th>
            <th>Proposal</th>
            <th>Surat Izin Magang</th>
            <th>Surat Balasan</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody>
          {% for row in data %}
          <tr>
            <td>{{ row.nama }}</td>
            <td>{{ row.email }}</td>
            <td>{{ row.no_telp }}</td>
            <td>{{ row.universitas }}</td>
            <td>{{ row.tgl_mulai }}</td>
            <td>{{ row.tgl_selesai }}</td>

            <!-- link proposal -->
            <td>
              {% if row.proposal %}
              <a
                href="{{ url_for('uploaded_file', filename=row.proposal) }}"
                target="_blank"
                >üìÑ Lihat Proposal</a
              >
              {% else %} - {% endif %}
            </td>

            <!-- data statistik admin -->
            <td>
              {% if row.admin_dashboard %}
              <a
                href="{{ url_for('admin_dashboard') }}"
                class="btn btn-primary"
              >
                üìä Lihat Dashboard Statistik
              </a>
              {% else %} - {% endif %}
            </td>

            <!-- link surat izin -->
            <td>
              {% if row.surat_izin %}
              <a
                href="{{ url_for('uploaded_file', filename=row.surat_izin) }}"
                target="_blank"
                >üìë Lihat Surat</a
              >
              {% else %} - {% endif %}
            </td>

            <!-- upload & lihat surat balasan -->
            <td>
              {% if row.surat_balasan %}
              <a
                href="{{ url_for('uploaded_file', filename=row.surat_balasan) }}"
                target="_blank"
                >üì• Lihat Balasan</a
              >
              {% else %}
              <form
                action="{{ url_for('upload_balasan', id=row.id) }}"
                method="POST"
                enctype="multipart/form-data"
              >
                <input type="file" name="surat_balasan" required />
                <button type="submit" class="btn-upload">‚¨Ü Upload</button>
              </form>
              {% endif %}
            </td>

            <td>{{ row.status or '-' }}</td>
            <td class="actions">
              <a
                href="{{ url_for('update_status', id=row.id, status='sedang didisposisi') }}"
                class="btn-action blue"
                title="Disposisi"
                >üìÇ</a
              >
              <a
                href="{{ url_for('accept_pendaftaran', id=row.id) }}"
                class="btn-action green"
                title="Terima"
                >‚úî</a
              >
              <a
                href="{{ url_for('reject_pendaftaran', id=row.id) }}"
                class="btn btn-danger btn-sm"
                title="Tolak"
                >‚ùå</a
              >
            </td>
          </tr>
          {% else %}
          <tr>
            <td colspan="11">Belum ada data pendaftar</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- data statistik -->
    <div style="text-align: right; margin-bottom: 20px">
      <a
        href="{{ url_for('admin_dashboard') }}"
        class="btn btn-primary"
        style="
          background: #27528b;
          color: white;
          padding: 8px 16px;
          border-radius: 6px;
          text-decoration: none;
        "
      >
        üìä Lihat Dashboard Statistik
      </a>
    </div>

    <!-- Pagination -->
    <div class="pagination">
      {% if page > 1 %}
      <a href="{{ url_for('admin_dashboard', page=page-1, search=search) }}"
        >‚èÆ Prev</a
      >
      {% endif %} {% for p in range(1, total_pages + 1) %} {% if p == page %}
      <span class="active">{{ p }}</span>
      {% else %}
      <a href="{{ url_for('admin_dashboard', page=p, search=search) }}"
        >{{ p }}</a
      >
      {% endif %} {% endfor %} {% if page < total_pages %}
      <a href="{{ url_for('admin_dashboard', page=page+1, search=search) }}"
        >Next ‚è≠</a
      >
      {% endif %}
    </div>
  </div>
</div>

<!-- CSS -->
<style>
  .dashboard-container {
    font-family: Arial, sans-serif;
    padding: 20px;
  }

  .stats {
    display: flex;
    gap: 20px;
    margin: 20px 0;
    flex-wrap: wrap;
  }

  .card {
    background: #224b84;
    color: white;
    padding: 20px;
    border-radius: 15px;
    flex: 1;
    text-align: center;
    min-width: 180px;
  }

  /* Tabel container */
  .table-container {
    background: #224b84;
    padding: 15px;
    border-radius: 15px;
    color: white;
  }

  /* Header tabel */
  .table-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
  }

  .table-header input {
    border-radius: 20px;
    padding: 5px 10px;
    border: none;
  }

  .table-header button {
    background: white;
    border: none;
    border-radius: 50%;
    cursor: pointer;
    padding: 5px 10px;
  }

  /* üîπ Wrapper agar tabel bisa di-scroll horizontal */
  .table-wrapper {
    width: 100%;
    overflow-x: auto;
    overflow-y: hidden;
    background: transparent;
    margin-top: 10px;
  }

  /* üîπ Tabel utama */
  .data-table {
    width: 100%;
    min-width: 900px; /* supaya bisa di-scroll kalau kolom banyak */
    border-collapse: collapse;
    background: white;
    color: black;
    border-radius: 8px;
    overflow: hidden;
  }

  .data-table th,
  .data-table td {
    border: 1px solid #ddd;
    padding: 10px;
    text-align: center;
    white-space: nowrap;
  }

  .data-table th {
    background-color: #27528b;
    color: white;
  }

  /* Tombol aksi */
  .actions {
    display: flex;
    justify-content: center;
    gap: 6px;
  }

  .btn-action {
    padding: 4px 8px;
    border-radius: 6px;
    text-decoration: none;
    font-size: 14px;
    font-weight: bold;
  }

  .btn-action.blue {
    background: #3b82f6;
    color: white;
  }
  .btn-action.green {
    background: #22c55e;
    color: white;
  }
  .btn-action.red {
    background: #faf9f9ff;
    color: white;
  }
  .btn-action:hover {
    opacity: 0.85;
  }

  /* Tombol upload */
  .btn-upload {
    background: #ffd700;
    color: black;
    border: none;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    margin-top: 5px;
  }
  .btn-upload:hover {
    background: #e6c200;
  }

  /* Pagination */
  .pagination {
    margin-top: 20px;
    display: flex;
    justify-content: center;
    gap: 5px;
    align-items: center;
    flex-wrap: wrap;
  }

  .pagination a,
  .pagination span {
    background: #224b84;
    color: white;
    padding: 6px 12px;
    border-radius: 6px;
    text-decoration: none;
  }

  .pagination .active {
    background: #1a3865;
    font-weight: bold;
  }

  .pagination a:hover {
    background: #1a3865;
  }

  /* Responsif */
  @media (max-width: 768px) {
    .table-header h3 {
      width: 100%;
      text-align: center;
    }
    .stats {
      flex-direction: column;
    }
    .card {
      width: 100%;
    }
  }
</style>

{% endblock %}
